module.exports = (function() {
var __MODS__ = {};
var __DEFINE__ = function(modId, func, req) { var m = { exports: {}, _tempexports: {} }; __MODS__[modId] = { status: 0, func: func, req: req, m: m }; };
var __REQUIRE__ = function(modId, source) { if(!__MODS__[modId]) return require(source); if(!__MODS__[modId].status) { var m = __MODS__[modId].m; m._exports = m._tempexports; var desp = Object.getOwnPropertyDescriptor(m, "exports"); if (desp && desp.configurable) Object.defineProperty(m, "exports", { set: function (val) { if(typeof val === "object" && val !== m._exports) { m._exports.__proto__ = val.__proto__; Object.keys(val).forEach(function (k) { m._exports[k] = val[k]; }); } m._tempexports = val }, get: function () { return m._tempexports; } }); __MODS__[modId].status = 1; __MODS__[modId].func(__MODS__[modId].req, m, m.exports); } return __MODS__[modId].m.exports; };
var __REQUIRE_WILDCARD__ = function(obj) { if(obj && obj.__esModule) { return obj; } else { var newObj = {}; if(obj != null) { for(var k in obj) { if (Object.prototype.hasOwnProperty.call(obj, k)) newObj[k] = obj[k]; } } newObj.default = obj; return newObj; } };
var __REQUIRE_DEFAULT__ = function(obj) { return obj && obj.__esModule ? obj.default : obj; };
__DEFINE__(1646653978721, function(require, module, exports) {
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).RollupLearn=t()}(this,(function(){var e;var t={errorCode:function(t,i,s,n){return e.errorCode(t,i,s,n)},getDeviceInfo:function(t){return e.getDeviceInfo(t)},Logger:{debug:function(...t){e.Logger.debug(...t)},info:function(...t){e.Logger.info(...t)},warn:function(...t){e.Logger.warn(...t)},error:function(...t){e.Logger.error(...t)}}};class i{constructor(){this.size=0,this.values=[]}build(){let e=new ArrayBuffer(this.size),t=new DataView(e);return this.values.forEach((({byteOffset:e,method:i,value:s,littleEndian:n,limitSize:r})=>{if("setBuffer"===i){let i=new DataView(s),n=i.byteLength;r&&(n=Math.min(r,n));for(let s=0;s<n;s++)t.setUint8(e+s,i.getUint8(s))}else"setUint8"===i?t[i](e,s):"setInt8"===i?s>0?t.setUint8(e,255&s):t.setUint8(e,s+256&255):"setUint24"===i?n?t.setUint32(e,s):t.setUint32(e,s<<8,!1):t[i](e,s,n)})),e}appendUint8(e){return this.values.push({byteOffset:this.size,method:"setUint8",value:e}),this.size++,this}appendUint16(e,t){return this.values.push({byteOffset:this.size,method:"setUint16",value:e,littleEndian:t}),this.size+=2,this}appendUint32(e,t){return this.values.push({byteOffset:this.size,method:"setUint32",value:e,littleEndian:t}),this.size+=4,this}appendBuffer(e,t){return this.values.push({byteOffset:this.size,method:"setBuffer",value:e,limitSize:t}),this.size+=t||e.byteLength,this}appendUint24(e,t){return this.values.push({byteOffset:this.size,method:"setUint24",value:e,littleEndian:t}),this.size+=3,this}appendInt8(e){return this.values.push({byteOffset:this.size,method:"setInt8",value:e}),this.size++,this}appendInt16(e,t){return this.values.push({byteOffset:this.size,method:"setInt16",value:e,littleEndian:t}),this.size+=2,this}appendFloat32(e,t){return this.values.push({byteOffset:this.size,method:"setFloat32",value:e,littleEndian:t}),this.size+=4,this}}class s{constructor(e,t){this.tag=128,this.utc=e,this.timezone=t}getBytes(){return(new i).appendUint32(this.utc,!0).appendInt16(this.timezone,!0).build()}}function n(e){return e.length>16?e:`0000${e}-0000-1000-8000-00805F9B34FB`}function r(e){return function(e){if(!e)return"";let t=new Uint8Array(e);var i,s,n,r,a,h;i="",n=t.length,s=0;for(;s<n;)switch((r=t[s++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(r);break;case 12:case 13:a=t[s++],i+=String.fromCharCode((31&r)<<6|63&a);break;case 14:a=t[s++],h=t[s++],i+=String.fromCharCode((15&r)<<12|(63&a)<<6|(63&h)<<0)}return i}(e)}function a(e,t,i){return e?(t.getUint8(i+2)<<16)+(t.getUint8(i+1)<<8)+t.getUint8(i):(t.getUint8(i)<<16)+(t.getUint8(i+1)<<8)+t.getUint8(i+2)}wx.getSystemInfoSync();class h{constructor(e,t=0){this.values=[],this.parseSize=0,this.originalBuffer=e,this.index=t,this.parseSize=0,this.dataView=new DataView(e),this.index=t}build(e){if(!this.originalBuffer||this.originalBuffer.byteLength<=0)return null;e||(e={});let t=this.dataView;return this.values.forEach((({byteOffset:i,method:s,key:n,size:h,parseKey:o,littleEndian:d})=>{i+=this.parseSize;try{if("getHexString"===s)e[n]=function(e,t){if(!e)return"";if("string"==typeof e)return e;let i=Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)}));if(t){let e=[];for(let t=0;t<i.length;t++)e.push(i[i.length-1-t]);return e.join("")}return i.join("")}(this.originalBuffer.slice(i,i+h));else if("getStringByParse"===s){let t=e[o];this.parseSize+=t,e[n]=r(this.originalBuffer.slice(i,i+t))}else if("getString"===s)e[n]=r(this.originalBuffer.slice(i,i+h));else if("getBuffer"===s)e[n]=this.originalBuffer.slice(i,i+h);else if("getUint8"===s)e[n]=t.getUint8(i);else if("Uint24"===s)e[n]=a(d,t,i);else if("Uint8Array"===s)e[n]=[].slice.call(new Uint8Array(this.originalBuffer.slice(i,i+h)));else if("Uint16Array"===s){let t=[].slice.call(new Uint16Array(this.originalBuffer.slice(i,i+h)));e[n]=d?t:function(e){if(e&&e.length>0){let t=[];for(let i=0;i<e.length;i++){let s=e[i];s=((255&s)<<8)+(s>>8&255),t.push(s)}return t}return[]}(t)}else if("SFloat"===s){let s=t.getUint8(i),r=((15&s)<<8)+t.getUint8(i+1),a=(240&s)>>>4,h=a;(8&a)>0&&(h=a-16);let o=Math.pow(10,h);e[n]=r*o}else if("Float"===s){let s=t.getUint8(i),r=a(d,t,i+1),h=Math.pow(10,(15&s)-16);e[n]=r*h}else e[n]=t[s](i,d)}catch(e){}})),e}getUint24(e,t=!1){return this.values.push({byteOffset:this.index,method:"Uint24",key:e,littleEndian:t}),this.index+=3,this}getSFloat(e){return this.values.push({byteOffset:this.index,method:"SFloat",key:e}),this.index+=2,this}getFloat(e,t=!1){return this.values.push({byteOffset:this.index,method:"Float",key:e,littleEndian:t}),this.index+=4,this}getUint8Array(e,t){return this.values.push({byteOffset:this.index,size:t,method:"Uint8Array",key:e}),this.index+=t,this}getUint16Array(e,t,i=!1){return this.values.push({byteOffset:this.index,size:t,method:"Uint16Array",key:e,littleEndian:i}),this.index+=t,this}getUint8(e){return this.values.push({byteOffset:this.index,method:"getUint8",key:e}),this.index++,this}getUint16(e,t=!1){return this.values.push({byteOffset:this.index,method:"getUint16",key:e,littleEndian:t}),this.index+=2,this}getUint32(e,t=!1){return this.values.push({byteOffset:this.index,method:"getUint32",key:e,littleEndian:t}),this.index+=4,this}getBuffer(e,t){return this.values.push({byteOffset:this.index,size:t,method:"getBuffer",key:e}),this.index+=t,this}getByteOffset(){return this.index}getString(e,t){return this.values.push({byteOffset:this.index,size:t,method:"getString",key:e}),this.index+=t,this}getHexString(e,t){return this.values.push({byteOffset:this.index,size:t,method:"getHexString",key:e}),this.index+=t,this}getStringSizeByParse(e,t){return this.values.push({byteOffset:this.index,parseKey:t,method:"getStringByParse",key:e}),this}getIndex(){return this.index}readUint8(){let e=this.index;return this.index+=1,this.dataView.getUint8(e)}readUint16(e=!1){let t=this.index;return this.index+=2,this.dataView.getUint16(t,e)}readInt16(e=!1){let t=this.index;return this.index+=2,this.dataView.getInt16(t,e)}readUint24(e=!1){let t=this.index;return this.index+=3,a(e,this.dataView,t)}readUint32(e=!1){let t=this.index;return this.index+=4,this.dataView.getUint32(t,e)}readInt32(e=!1){let t=this.index;return this.index+=4,this.dataView.getInt32(t,e)}readSfloat(){let e=this.index,t=this.dataView;this.index+=2;let i=t.getUint8(e),s=(240&i)>>>4,n=s;return(8&s)>0&&(n=s-16),(((15&i)<<8)+t.getUint8(e+1))*Math.pow(10,n)}readFloat(e=!1){let t=this.index;this.index+=4;let i=this.dataView.getUint8(t);return a(e,this.dataView,t+1)*Math.pow(10,(15&i)-16)}readString(e){return r(this.readBuffer(e))}readBuffer(e){let t=this.index;return this.index+=e,this.dataView.buffer.slice(t,t+e)}}class o{constructor(e,t,i){this.dataType="JumpRealtime",this.cmd=t;let s=new h(e);s.getUint8("jumpMode").getUint16("settingContent",!0).getUint16("duration",!0).getUint16("count",!0).getUint8("groupCount").getUint8("battery"),e.byteLength>=11&&s.getUint16("validDuration",!0),s.build(this),this.freq=i?Math.max(0,60*(this.count-i.count)):0}}class d{constructor(e,t){this.dataType="",this.dataType=2===t?"JumpResultData":"JumpHistoryData";let i=new h(e);i.getUint32("utc",!0).getUint8("jumpMode").getUint16("settingContent",!0).getUint16("duration",!0).getUint16("count",!0).getUint16("avgFreq",!0).getUint16("maxFreq",!0).getUint16("maxContinueCount",!0).getUint8("groupCount").build(this);let s=this.groupCount,n=[];for(let e=0;e<s+1;e++){let e=i.readUint16(!0),t=i.readUint16(!0);n.push({time:e,count:t})}this.list=n}}var u=Object.freeze({__proto__:null,BeginToJumpSetting:class{constructor(e,t,i,s){this.tag=129,this.jumpMode=e,this.settingContent=t,this.utc=i,this.numberOfCountdown=s}getBytes(){return(new i).appendInt8(this.jumpMode).appendUint16(this.settingContent,!0).appendUint32(this.utc,!0).appendUint16(this.numberOfCountdown,!0).build()}},EndToJumpSetting:class{constructor(){this.tag=130}getBytes(){return(new i).appendInt8(0).build()}},MioSyncTimeSetting:s,MioJumpRealtimeData:o,MioJumpResultData:d});const l="0000FFD0-0000-1000-8000-00805F9B34FB",c="0000FFD1-0000-1000-8000-00805F9B34FB",f="0000FFD2-0000-1000-8000-00805F9B34FB",g="00005630-55AA-EFDE-2323-985FEABCD512";function p(e,...t){let i=0;if(e){let t=new DataView(e);for(let e=0;e<t.byteLength;e++)i+=t.getUint8(e)}if(t)for(let e=0;e<t.length;e++)i+=t[e];return 65535&i}function m(){return(new Date).getTime()/1e3}function v(){let e=(new Date).getTimezoneOffset(),t=e>0;e=Math.abs(e);let i=(60*(e/60)+e%60)/15;return t&&(i=-i),i+48}var y=[{name:"EnableCharacteristic",serviceId:l,characteristicId:f,actionType:2},{name:"SyncTime",actionType:1,pushData(e){let t=m(),i=v();return new s(t,i)}}],U=[{name:"EnableCharacteristic",serviceId:l,characteristicId:f,actionType:2},{name:"SyncTime",actionType:1,pushData(e){let t=m(),i=v();return new s(t,i)}}];function b(e){if(!e||0===e.byteLength)return"";let t=new DataView(e),i="";for(let e=0;e<t.byteLength;e++)i+=t.getUint8(e).toString(16).padStart(2,"0").toUpperCase();return i}function w(e){if(!e||0===e.byteLength)return;let t=new DataView(e),i=new ArrayBuffer(e.byteLength),s=new DataView(i);for(let i=0;i<e.byteLength;i++){let n=e.byteLength-i-1;s.setUint8(i,t.getUint8(n))}return s.buffer}var S=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{o(s.next(e))}catch(e){r(e)}}function h(e){try{o(s.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,h)}o((s=s.apply(e,t||[])).next())}))};class x{constructor(e,i){this.buf=e,this.isClear=!1,this.timeout=5e3,this.sid=i||Math.random(),this.trySender=(e,i)=>S(this,void 0,void 0,(function*(){try{return this.sender(e,i)}catch(e){if(this.isClear)return t.errorCode(4);this.callback(e)}}))}didReceiveData(e){}start(){}resetTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout((()=>{this.callback(t.errorCode(3,this.tag))}),this.timeout)}clear(){this.isClear=!0,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.callback(t.errorCode(4))}callback(e){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),e.success?t.Logger.debug("session 会话结束了",e.data.toString(16),b(e.value)):t.Logger.warn("会话失败了",e),this.completion&&(e.sid=this.sid,this.completion(e),this.completion=null)}}class C extends x{constructor(e,t){super(e),this.needAck=!1,this.tag=t}start(){return S(this,void 0,void 0,(function*(){let e=this.decodeToFrames(this.buf);if(e&&e.length<1)return void this.callback(t.errorCode(4,this.tag));this.resetTimeout();let i=this.sendChar;for(let s=0;s<e.length;s++){let n=e[s];try{yield this.trySender(n,i)}catch(e){return void this.callback(t.errorCode(1,this.tag))}}this.needAck||this.callback(t.errorCode(0,this.tag))}))}decodeToFrames(e){let t=e.byteLength,i=Math.ceil(t/this.mtu),s=[];for(let t=0;t<i;t++){let i=t*this.mtu;s.push(e.slice(i,i+this.mtu))}return s}}class F extends x{didReceiveData(e){this.receiveBuf=e.value,this.callback(t.errorCode(0,this.tag,this.receiveBuf))}start(){this.didReceiveData({value:this.buf})}checkFinished(){if(!this.receiveBuf)return!1;if(this.firstFrame.len&&this.firstFrame.len<=this.receiveBuf.byteLength)return!0;if(this.firstFrame.totalFrames){if(1==this.firstFrame.totalFrames)return!0;if(this.preFrame&&this.preFrame.index===this.firstFrame.totalFrames-1)return!0}return!1}decodeFirstFrame(e){throw new Error("如果使用默认的逻辑，则需要实现这个逻辑")}decodeOtherFrame(e){throw new Error("如果使用默认的逻辑，则需要实现这个逻辑")}}class I{constructor(e){this.sendSessions=[],this.filterServiceIds=[],this.mtu=20,this.context=e}sendData(e,t,i,s){let n=this.createSenderSession(e,t,i);return n.sender=this.sender,n.mtu=this.mtu,n.tag=t,new Promise(((e,t)=>{n.completion=i=>{this.sendingSession=null,s&&s(i),this.tryToDispatchSession(),i.success?e(i):t(i)},this.sendSessions.push(n),this.tryToDispatchSession()}))}clear(){try{this.sendSessions.forEach((e=>{e.clear()})),this.sendSessions.length=0,this.sendingSession&&(this.sendingSession.clear(),this.sendingSession=null)}catch(e){}}updateMtu(e){this.mtu=e}didReceiveData(e){if(this.receiveringSession)this.receiveringSession.didReceiveData(e);else{this.receiveringSession=this.createReceiveSession(e.value),this.receiveringSession.mtu=this.mtu,this.receiveringSession.sender=this.sender;let t=this;this.receiveringSession.completion=e=>{t.receiveringSession&&t.receiveringSession.sid===e.sid&&(t.receiveringSession=null),t.tryToDispatchSession(),t.listener&&t.listener(e)},this.receiveringSession.start()}}createSenderSession(e,t,i){return new C(e,t)}createReceiveSession(e){return new F(e)}tryToDispatchSession(){if(this.sendingSession||0===this.sendSessions.length||this.receiveringSession)return;let e=this.sendSessions.shift();e&&(this.sendingSession=e,e.start())}}var B=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{o(s.next(e))}catch(e){r(e)}}function h(e){try{o(s.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,h)}o((s=s.apply(e,t||[])).next())}))};class D extends F{constructor(){super(...arguments),this.sendChar={serviceId:l,charId:c,writeType:0}}didReceiveData(e){let i=new DataView(e.value);if(this.checkIsFirstFrame(i))this.firstFrame=this.decodeFirstFrame(i),this.receiveBuf=this.firstFrame.buf;else{this.resetTimeout();let e=this.decodeOtherFrame(i);if(this.preFrame){if(this.preFrame.index!==e.index-1)return void this.callback(t.errorCode(5,this.tag));this.preFrame=e}else this.preFrame=e;if(this.receiveBuf){let t=this.receiveBuf.byteLength+e.buf.byteLength;this.receiveBuf=function(e,t){let i=new ArrayBuffer(t),s=new DataView(i),n=0;return e.forEach((e=>{let i=new DataView(e);for(let r=0;r<e.byteLength&&n<t;r++)s.setUint8(n,i.getUint8(r)),n++})),i}([this.receiveBuf,e.buf],t)}else this.callback(t.errorCode(5,this.tag))}if(this.checkFinished()){if(1===this.tag)return void this.callback(t.errorCode(0,this.tag,this.receiveBuf));this.sendAck()}}checkIsFirstFrame(e){return 252===e.getUint8(0)}decodeFirstFrame(e){let t=new h(e.buffer),i=t.readUint8(),s=t.readUint8(),n=t.readUint16(!0),r=t.readUint8(),a=t.readUint16(!0),o=t.readBuffer(this.mtu-7);return this.tag=r,{header:i,protoVersion:s,checkCode:n,cmd:r,len:a,buf:o}}decodeOtherFrame(e){let t=new h(e.buffer);return{index:t.readUint8(),buf:t.readBuffer(this.mtu-1)}}sendAck(){return B(this,void 0,void 0,(function*(){try{new ArrayBuffer(8);let e=p(null,this.tag,1),t=(new i).appendUint8(252).appendUint8(160).appendUint16(e,!0).appendInt8(this.tag).appendUint16(1,!0).appendUint8(0);yield this.trySender(t.build(),this.sendChar)}catch(e){return void this.callback(t.errorCode(1,this.tag))}this.callback(t.errorCode(0,this.tag,this.receiveBuf))}))}}class k extends C{constructor(){super(...arguments),this.sendChar={serviceId:l,charId:c,writeType:0}}decodeToFrames(e){let t=this.mtu-7,s=e.byteLength,n=p(e,this.tag,s),r=new i;if(r.appendUint8(252),r.appendUint8(160),r.appendUint16(n,!0),r.appendUint8(this.tag),r.appendUint16(e.byteLength,!0),s<=t)return r.appendBuffer(e),[r.build()];{r.appendBuffer(e.slice(0,t));let n=[];n.push(r.build());let a=this.mtu-1,h=Math.ceil((s-t)/a);for(let s=0;s<h;s++){let r=new i,h=t+a*s;r.appendUint8(s+1),r.appendBuffer(e.slice(h,h+a)),n.push(r.build())}return n}}}class O extends I{constructor(){super(...arguments),this.filterServiceIds=[l]}didReceiveData(e){252===new DataView(e.value).getUint8(0)?(this.receiveringSession=this.createReceiveSession(e.value),this.receiveringSession.mtu=this.mtu,this.receiveringSession.sender=this.sender,this.receiveringSession.completion=e=>{this.receiveringSession&&this.receiveringSession.sid===e.sid&&(this.receiveringSession=null),this.tryToDispatchSession(),this.listener&&e.success&&this.listener(e)},this.receiveringSession.start()):this.receiveringSession&&this.receiveringSession.didReceiveData(e)}createSenderSession(e){return new k(e)}createReceiveSession(e){return new D(e)}}var T=function(e,t,i,s){return new(i||(i=Promise))((function(n,r){function a(e){try{o(s.next(e))}catch(e){r(e)}}function h(e){try{o(s.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,h)}o((s=s.apply(e,t||[])).next())}))};class z extends C{constructor(){super(...arguments),this.sendChar={serviceId:g,charId:"00005631-55AA-EFDE-2323-985FEABCD512",writeType:0},this.sendPackageChar={serviceId:g,charId:"00005632-55AA-EFDE-2323-985FEABCD512",writeType:0},this.numberOfpacket=10,this.tag=255,this.sendOffset=0}start(){return T(this,void 0,void 0,(function*(){this.sendOpCode(1)}))}didReceiveData(e){let i=new h(e.value),s=i.readUint8();if(17===s){let e=i.readUint32(!0),t=e/this.otaParse.buf.byteLength;this.otaParse.onUpgradeProcess&&this.otaParse.onUpgradeProcess(100*t),this.sendOffset=e,e<this.otaParse.buf.byteLength&&this.sendPackage()}else if(16===s){let e=i.readUint8();if(1!=i.readUint8())return void this.callback(t.errorCode(5,this.tag));switch(e){case 1:this.sendOpCode(2);break;case 2:this.sendOpCode(8);break;case 3:this.sendOpCode(4);break;case 4:this.sendOpCode(5),this.callback(t.errorCode(0,this.tag))}}}callback(e){this.timeoutId&&clearTimeout(this.timeoutId),this.completion&&(this.otaParse.onUpgradeComplete&&this.otaParse.onUpgradeComplete(e.code,e.msg),this.completion(e),this.completion=null)}sendStartBin(){return T(this,void 0,void 0,(function*(){let e=(new i).appendUint8(1).appendUint8(4).build();var t;yield this.trySender(e,this.sendChar),yield(t=.5,new Promise(((e,i)=>{setTimeout((()=>{e(null)}),t)}))),this.sendImageSize()}))}sendImageSize(){return T(this,void 0,void 0,(function*(){let e=(new i).appendUint32(0).appendUint32(0).appendUint32(this.otaParse.buf.byteLength,!0).build();yield this.trySender(e,this.sendPackageChar),this.resetTimeout()}))}sendHeader(){return T(this,void 0,void 0,(function*(){let e=(new i).appendInt8(2).appendUint8(0).build();yield this.trySender(e,this.sendChar);let t=(new i).appendUint16(this.otaParse.deviceType,!0).appendUint16(this.otaParse.projectNumber,!0).appendUint32(this.otaParse.version,!0).appendUint16(this.otaParse.softVersion,!0).appendUint16(this.otaParse.supportSoftDevice,!0).appendUint16(this.otaParse.firmwareCrc16,!0).build();yield this.trySender(t,this.sendPackageChar);let s=(new i).appendInt8(2).appendUint8(1).build();this.trySender(s,this.sendChar)}))}sendOpCode(e){return T(this,void 0,void 0,(function*(){switch(e){case 1:yield this.sendStartBin();break;case 2:yield this.sendHeader();break;case 8:yield this.receiptNotificationReq(),yield this.sendOpCode(3),this.sendPackage();break;default:let t=(new i).appendUint8(e).build();yield this.trySender(t,this.sendChar)}}))}receiptNotificationReq(){let e=(new i).appendUint8(8).appendUint16(this.numberOfpacket,!0).build();return this.trySender(e,this.sendChar)}sendPackage(){return T(this,void 0,void 0,(function*(){let e=this.sendOffset,t=this.otaParse.buf.byteLength;for(let i=0;i<this.numberOfpacket;i++){let i=Math.min(t-e,this.mtu);if(i<=0)return;let s=this.otaParse.buf.slice(e,e+i);e+=i,yield this.trySender(s,this.sendPackageChar)}this.resetTimeout()}))}}class A extends I{didReceiveData(e){this.sendingSession&&this.sendingSession.didReceiveData(e)}createSenderSession(e,t,i){let s=new z(e);return s.otaParse=t,s}}const P={uuid:l,name:"skip",bind:{protocolType:0,actions:y},sync:{protocolType:1,actions:U},parser:new class{parseAdvertisementData(e,t){let i=e.name,s=t.localName,n=e.deviceId,r=t.advertisData;if(r&&r instanceof ArrayBuffer){let e=new h(r);e.readUint8(),e.readUint8();let a=e.readBuffer(6);a=w(a);let o=b(a);return e.readUint8(),e.readUint16(!0),e.readUint32(!0),e.readUint16(!0),e.readUint16(!0),r.byteLength>=21&&e.readUint16(!0),r.byteLength>=22&&e.readUint8(),{name:i,localName:s,deviceId:n,manufacturerData:r,serviceUUIDs:t.advertisServiceUUIDs,serviceData:t.serviceData,RSSI:t.RSSI,mac:o,isSystemPaired:!1,timestamp:new Date}}return{}}parseDeviceInfo(e,t){let i=t.get(n("2A25")),s="";i&&i.byteLength>=12&&(s=r(i.slice(0,12)));let a=t.get(n("2A23")),h="";a&&(a=w(a),h=b(a));let o=r(t.get(n("2A24"))),d=r(t.get(n("2A26"))),u=r(t.get(n("2A28"))),l=r(t.get(n("2A27"))),c=r(t.get(n("2A29")));return{name:e.name,deviceId:e.deviceId,manufacture:c,model:o,mac:s,softwareVersion:u,hardwareVersion:l,firmwareVersion:d,serialId:h}}},dataParser:new class{constructor(){this.lastRealtimeMap=new Map}parseData(e,i,s){let n=e.data,r=e.value;switch(n){case 1:let e=s.deviceInfo.mac,i=this.lastRealtimeMap.get(e),a=new o(r,n,i);return s.deviceInfo.battery=a.battery,this.lastRealtimeMap.set(e,a),a;case 2:case 3:return new d(r,n);default:t.Logger.warn("未知数据, 没有处理"+n)}}createSession(e){return l===e?new O:new A}},setUtils:function(t){e=t}};var L={settingFactory:u,proto:P};return module.exports={settingFactory:u,proto:P},L}));

}, function(modId) {var map = {}; return __REQUIRE__(map[modId], modId); })
return __REQUIRE__(1646653978721);
})()
//miniprogram-npm-outsideDeps=[]
//# sourceMappingURL=index.js.map